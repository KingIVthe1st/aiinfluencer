(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{2412:(e,s,t)=>{Promise.resolve().then(t.bind(t,3821))},3821:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var l=t(5155);function r(){let e=useParams(),s=useRouter(),t=e.id,[r,a]=useState(null),[i,n]=useState([]),[o,d]=useState([]),[c,x]=useState([]),[m,h]=useState(null),[u,b]=useState(!0),[p,f]=useState(""),[g,v]=useState(null),[j,N]=useState(null),[w,k]=useState(!1),[y,L]=useState(!1),[S,C]=useState(null);async function M(){try{var e;b(!0),f("");let s=await musicAPI.getSong(t);if(a(s.song),n(s.versions||[]),d(s.lyricVersions||[]),x(s.sections||[]),null==(e=s.song)?void 0:e.singerId){let e=await singersAPI.get(s.song.singerId);h(e.singer)}b(!1)}catch(e){console.error("[SongDetail] Load error:",e),f(e instanceof Error?e.message:"Failed to load song"),b(!1)}}async function A(e){try{C(e),await musicAPI.activateVersion(t,e),await M(),C(null)}catch(e){console.error("[SongDetail] Activate version error:",e),alert("Failed to activate version"),C(null)}}async function B(){try{await musicAPI.deleteSong(t),s.push("/dashboard/music")}catch(e){console.error("[SongDetail] Delete error:",e),alert("Failed to delete song")}}function V(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}useEffect(()=>{M()},[t]),useEffect(()=>{if((null==r?void 0:r.status)==="generating"||i.some(e=>"generating"===e.status)){let e=setInterval(()=>{M()},3e3);return()=>clearInterval(e)}},[r,i]),useEffect(()=>{if((null==r?void 0:r.activeVersionId)&&i.length>0&&!g){let e=i.find(e=>e.id===r.activeVersionId);e?v(e):i.length>0&&v(i[0])}},[r,i]),useEffect(()=>{o.length>0&&!j&&N(o[0])},[o]);let I=(null==r?void 0:r.mood)?JSON.parse(r.mood):[];return u?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsx)("div",{className:"w-12 h-12 border-4 border-violet-200 border-t-violet-600 rounded-full animate-spin"})}):p||!r?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,l.jsxs)("div",{className:"max-w-md w-full rounded-2xl bg-white/70 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Song Not Found"}),(0,l.jsx)("p",{className:"text-slate-600 mb-6",children:p||"The song you're looking for doesn't exist."}),(0,l.jsxs)(Link,{href:"/dashboard/music",className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold hover:from-violet-700 hover:to-fuchsia-700 transition-all",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Music"]})]})}):(0,l.jsxs)("div",{className:"min-h-screen p-6 pb-24",children:[(0,l.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)(Link,{href:"/dashboard/music",className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,l.jsx)("span",{className:"font-medium",children:"Back to Music"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(Link,{href:"/dashboard/music/".concat(t,"/edit"),className:"px-4 py-2 rounded-xl bg-white/70 backdrop-blur-xl border border-slate-200/50 text-slate-700 font-semibold hover:bg-white/90 transition-all",children:"Edit Song"}),(0,l.jsx)("button",{onClick:()=>L(!0),className:"px-4 py-2 rounded-xl bg-red-50 border border-red-200 text-red-600 font-semibold hover:bg-red-100 transition-all",children:"Delete Song"})]})]}),(0,l.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-violet-50 via-white to-fuchsia-50 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:r.title}),m&&(0,l.jsx)(Link,{href:"/dashboard/singers/".concat(r.singerId),className:"text-lg text-violet-600 hover:text-violet-700 font-semibold",children:m.name}),r.description&&(0,l.jsx)("p",{className:"text-slate-600 mt-3 max-w-2xl",children:r.description})]}),(0,l.jsx)("div",{className:"px-4 py-2 rounded-full text-sm font-bold capitalize ".concat("completed"===r.status?"bg-green-100 text-green-700":"generating"===r.status?"bg-yellow-100 text-yellow-700 animate-pulse":"failed"===r.status?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"),children:r.status})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"rounded-xl bg-white/70 backdrop-blur-xl p-4 border border-slate-200/50",children:[(0,l.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"BPM"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:r.bpm})]}),(0,l.jsxs)("div",{className:"rounded-xl bg-white/70 backdrop-blur-xl p-4 border border-slate-200/50",children:[(0,l.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Key"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:r.key})]}),r.genre&&(0,l.jsxs)("div",{className:"rounded-xl bg-white/70 backdrop-blur-xl p-4 border border-slate-200/50",children:[(0,l.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Genre"}),(0,l.jsx)("p",{className:"text-xl font-bold text-slate-900",children:r.genre})]}),(0,l.jsxs)("div",{className:"rounded-xl bg-white/70 backdrop-blur-xl p-4 border border-slate-200/50",children:[(0,l.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Versions"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:i.length})]})]}),I.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-4",children:I.map((e,s)=>(0,l.jsx)("span",{className:"px-3 py-1 rounded-lg bg-fuchsia-100 text-fuchsia-700 text-sm font-semibold",children:e},s))}),(0,l.jsxs)("div",{className:"flex items-center gap-6 mt-6 pt-6 border-t border-slate-200/50",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[(0,l.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),(0,l.jsxs)("span",{className:"font-semibold",children:[r.playCount," plays"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,l.jsxs)("span",{className:"font-semibold",children:[r.likeCount," likes"]})]}),(0,l.jsxs)("div",{className:"text-slate-500 text-sm",children:["Created ",V(r.createdAt)]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,l.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-6 border border-slate-200/50 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Version History"}),(0,l.jsx)(Link,{href:"/dashboard/music/".concat(t,"/generate"),className:"px-4 py-2 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold hover:from-violet-700 hover:to-fuchsia-700 transition-all",children:"Generate New Version"})]}),0===i.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),(0,l.jsx)("p",{className:"text-slate-600 mb-4",children:"No versions generated yet"}),(0,l.jsxs)(Link,{href:"/dashboard/music/".concat(t,"/generate"),className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold hover:from-violet-700 hover:to-fuchsia-700 transition-all",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Generate First Version"]})]}):(0,l.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,l.jsxs)("div",{className:"rounded-xl p-4 border-2 transition-all cursor-pointer ".concat((null==g?void 0:g.id)===e.id?"bg-violet-50 border-violet-300":"bg-white/50 border-slate-200/50 hover:bg-white/80"),onClick:()=>v(e),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsxs)("span",{className:"text-lg font-bold text-slate-900",children:["Version ",e.versionNumber]}),e.isActive&&(0,l.jsx)("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold",children:"ACTIVE"}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold capitalize ".concat("completed"===e.status?"bg-green-100 text-green-700":"generating"===e.status?"bg-yellow-100 text-yellow-700 animate-pulse":"failed"===e.status?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"),children:e.status})]}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mb-2",children:e.prompt}),e.stylePreset&&(0,l.jsx)("span",{className:"inline-block px-2 py-1 rounded-lg bg-violet-100 text-violet-700 text-xs font-semibold",children:e.stylePreset}),(0,l.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:["Created ",V(e.createdAt)]})]}),!e.isActive&&"completed"===e.status&&(0,l.jsx)("button",{onClick:s=>{s.stopPropagation(),A(e.id)},disabled:S===e.id,className:"px-3 py-1 rounded-lg bg-violet-600 text-white text-sm font-semibold hover:bg-violet-700 transition-all disabled:opacity-50",children:S===e.id?"Activating...":"Set Active"})]}),"completed"===e.status&&e.audioUrl&&(0,l.jsx)("div",{className:"mt-3 pt-3 border-t border-slate-200/50",children:(0,l.jsx)("audio",{controls:!0,className:"w-full",src:e.audioUrl,children:"Your browser does not support the audio element."})})]},e.id))})]}),c.length>0&&(0,l.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-6 border border-slate-200/50 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Song Structure"}),(0,l.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-xl bg-gradient-to-r from-violet-50 to-fuchsia-50 border border-slate-200/50",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"w-8 h-8 rounded-full bg-violet-600 text-white font-bold flex items-center justify-center text-sm",children:e.order}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"font-semibold text-slate-900 capitalize",children:[e.type,e.name&&" - ".concat(e.name)]}),e.notes&&(0,l.jsx)("p",{className:"text-sm text-slate-600",children:e.notes})]})]}),e.durationMs&&(0,l.jsx)("span",{className:"text-sm text-slate-600 font-mono",children:function(e){if(!e)return"N/A";let s=Math.floor(e/1e3),t=Math.floor(s/60);return"".concat(t,":").concat((s%60).toString().padStart(2,"0"))}(e.durationMs)})]},e.id))})]})]}),(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-6 border border-slate-200/50 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Lyrics"}),0===o.length?(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("p",{className:"text-slate-600 mb-4",children:"No lyrics added yet"}),(0,l.jsxs)(Link,{href:"/dashboard/music/".concat(t,"/lyrics"),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold hover:from-violet-700 hover:to-fuchsia-700 transition-all",children:[(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Lyrics"]})]}):(0,l.jsxs)(l.Fragment,{children:[o.length>1&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Version"}),(0,l.jsx)("select",{value:(null==j?void 0:j.id)||"",onChange:e=>{N(o.find(s=>s.id===e.target.value)||null)},className:"w-full px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-900 focus:outline-none focus:ring-2 focus:ring-violet-500",children:o.map(e=>(0,l.jsxs)("option",{value:e.id,children:["Version ",e.versionNumber," (",V(e.createdAt),")"]},e.id))})]}),j&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"rounded-xl bg-gradient-to-br from-violet-50 to-fuchsia-50 p-6 border border-slate-200/50",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-slate-900 leading-relaxed",children:j.text})}),j.writtenBy&&(0,l.jsxs)("p",{className:"text-sm text-slate-600",children:["Written by: ",j.writtenBy]}),(0,l.jsx)(Link,{href:"/dashboard/music/".concat(t,"/lyrics"),className:"block text-center px-4 py-2 rounded-xl bg-white border border-slate-200 text-slate-700 font-semibold hover:bg-slate-50 transition-all",children:"Edit Lyrics"})]})]})]})})]})]}),y&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-6 z-50",children:(0,l.jsxs)("div",{className:"max-w-md w-full rounded-2xl bg-white/90 backdrop-blur-xl p-8 border border-slate-200/50 shadow-2xl",children:[(0,l.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,l.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-2 text-center",children:"Delete Song?"}),(0,l.jsxs)("p",{className:"text-slate-600 mb-6 text-center",children:['This will permanently delete "',r.title,'" and all its versions. This action cannot be undone.']}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>L(!1),className:"flex-1 px-4 py-3 rounded-xl bg-slate-100 text-slate-700 font-semibold hover:bg-slate-200 transition-all",children:"Cancel"}),(0,l.jsx)("button",{onClick:B,className:"flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-semibold hover:bg-red-700 transition-all",children:"Delete Song"})]})]})})]})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=2412)),_N_E=e.O()}]);