(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[254],{63:(e,t,s)=>{"use strict";var r=s(7260);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},2327:(e,t,s)=>{"use strict";s.d(t,{Me:()=>c,R2:()=>d,eM:()=>m,ic:()=>g,lu:()=>u,qT:()=>l,u5:()=>a,vS:()=>h});let r="https://ai-singer-studio-production.ivanleejackson.workers.dev";class a extends Error{constructor(e,t,s){super(e),this.status=t,this.data=s,this.name="APIClientError"}}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if("string"==typeof e)return e;if(!e)return"Request failed";if("object"==typeof e&&t.has(e))return"Request failed (circular reference)";if("object"==typeof e&&t.add(e),"string"==typeof e.message)return e.message;if("string"==typeof e.error)return e.error;if("string"==typeof e.error_description)return e.error_description;if("string"==typeof e.detail)return e.detail;if(Array.isArray(e.errors)){let t=e.errors.map(e=>e.message||e.error||"Unknown error").filter(e=>"string"==typeof e);if(t.length>0)return t.join(", ")}if(Array.isArray(e.issues))return e.issues.map(e=>e.message?e.message:Array.isArray(e.path)&&e.path.length?"".concat(e.path.join("."),": ").concat(e.message||"Invalid value"):"Validation error").join(", ");if(Array.isArray(e)){let s=e.map(e=>"string"==typeof e?e:n(e,t)).filter(e=>e&&"Request failed"!==e);if(s.length>0)return s.join(", ")}if("object"==typeof e.error&&null!==e.error)return n(e.error,t);if("object"==typeof e.message&&null!==e.message)return n(e.message,t);if(e.details)return"string"==typeof e.details?e.details:JSON.stringify(e.details);try{let t=JSON.stringify(e);return t.length>200?t.substring(0,200)+"...":t}catch(e){return"Request failed"}}function o(){let e=localStorage.getItem("token")||localStorage.getItem("authToken")||sessionStorage.getItem("token");return console.log("[API Client] Token found:",!!e),e}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o(),i={"Content-Type":"application/json",...t.headers};s&&(i.Authorization="Bearer ".concat(s));let l="".concat(r).concat(e);console.log("[API Client] Request:",t.method||"GET",l);try{let e,s=await fetch(l,{...t,headers:i,credentials:"include"}),r=s.headers.get("content-type"),o=await s.text();if(o)if((null==r?void 0:r.includes("application/json"))||o.trim().startsWith("{")||o.trim().startsWith("["))try{e=JSON.parse(o)}catch(t){e={message:o}}else e={message:o};else e=null;if(!s.ok)throw console.error("[API Client] Error response:",{status:s.status,contentType:r,data:e}),new a(e?n(e):"Request failed with status ".concat(s.status),s.status,e);return console.log("[API Client] Success:",e),e}catch(e){if(e instanceof a)throw e;throw console.error("[API Client] Network error:",e),new a(e instanceof Error?e.message:"Network error occurred")}}let l={async listVoices(e){let t=e?"?category=".concat(encodeURIComponent(e)):"";return i("/api/voices/elevenlabs".concat(t))},getVoice:async e=>i("/api/voices/elevenlabs/".concat(e)),generateVoice:async e=>(console.log("[API Client] Generating voice with params:",e),i("/api/voices/elevenlabs/generate",{method:"POST",body:JSON.stringify(e)})),async cloneVoice(e){let t=o(),s={};t&&(s.Authorization="Bearer ".concat(t)),console.log("[API Client] Cloning voice");let i=await fetch("".concat(r,"/api/voices/elevenlabs/clone"),{method:"POST",headers:s,body:e,credentials:"include"}),l=await i.json();if(!i.ok)throw new a(n(l)||"Voice cloning failed",i.status,l);return l}},c={list:async()=>i("/api/singers"),get:async e=>i("/api/singers/".concat(e)),create:async e=>i("/api/singers",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>i("/api/singers/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>i("/api/singers/".concat(e),{method:"DELETE"})},d={me:async()=>i("/api/auth/me"),logout:async()=>i("/api/auth/logout",{method:"POST"})},u={getUsage:async()=>i("/api/users/usage"),getQuota:async()=>i("/api/users/me/quota")},m={async list(e){let t=new URLSearchParams;(null==e?void 0:e.type)&&t.set("type",e.type),(null==e?void 0:e.singerId)&&t.set("singerId",e.singerId),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.set("offset",e.offset.toString());let s=t.toString();return i("/api/assets".concat(s?"?".concat(s):""))},get:async e=>i("/api/assets/".concat(e)),delete:async e=>i("/api/assets/".concat(e),{method:"DELETE"}),getStats:async()=>i("/api/assets/stats")},h={async list(e){let t=new URLSearchParams;(null==e?void 0:e.status)&&t.set("status",e.status),(null==e?void 0:e.type)&&t.set("type",e.type),(null==e?void 0:e.singerId)&&t.set("singerId",e.singerId),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.set("offset",e.offset.toString());let s=t.toString();return i("/api/jobs".concat(s?"?".concat(s):""))},get:async e=>i("/api/jobs/".concat(e)),delete:async e=>i("/api/jobs/".concat(e),{method:"DELETE"}),retry:async e=>i("/api/jobs/".concat(e,"/retry"),{method:"POST"}),getStats:async()=>i("/api/jobs/stats")},g={createSong:async e=>i("/api/music/songs",{method:"POST",body:JSON.stringify(e)}),async listSongs(e){let t=new URLSearchParams;(null==e?void 0:e.singerId)&&t.set("singerId",e.singerId),(null==e?void 0:e.status)&&t.set("status",e.status),(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.set("offset",e.offset.toString());let s=t.toString();return i("/api/music/songs".concat(s?"?".concat(s):""))},getSong:async e=>i("/api/music/songs/".concat(e)),updateLyrics:async(e,t)=>i("/api/music/songs/".concat(e,"/lyrics"),{method:"POST",body:JSON.stringify(t)}),updateStructure:async(e,t)=>i("/api/music/songs/".concat(e,"/structure"),{method:"POST",body:JSON.stringify(t)}),generateVersion:async(e,t)=>i("/api/music/songs/".concat(e,"/generate"),{method:"POST",body:JSON.stringify(t)}),activateVersion:async(e,t)=>i("/api/music/songs/".concat(e,"/versions/").concat(t,"/activate"),{method:"POST"}),deleteSong:async e=>i("/api/music/songs/".concat(e),{method:"DELETE"})}},2797:(e,t,s)=>{Promise.resolve().then(s.bind(s,9254))},9254:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h,runtime:()=>c});var r=s(5155),a=s(2115),n=s(63),o=s(2619),i=s.n(o),l=s(2327);let c="edge",d=["Pop","Rock","Hip Hop","R&B","Country","Jazz","Electronic","Classical","Folk","Blues","Reggae","Metal","Punk","Indie","Soul","Funk"],u=["Happy","Sad","Energetic","Calm","Romantic","Angry","Nostalgic","Uplifting","Melancholic","Mysterious","Playful","Dramatic","Chill"],m=["C major","C# major","D major","D# major","E major","F major","F# major","G major","G# major","A major","A# major","B major","C minor","C# minor","D minor","D# minor","E minor","F minor","F# minor","G minor","G# minor","A minor","A# minor","B minor"];function h(){var e;let t=(0,n.useParams)(),s=(0,n.useRouter)(),o=t.id,[c,h]=(0,a.useState)(null),[g,x]=(0,a.useState)([]),[f,p]=(0,a.useState)(!0),[b,v]=(0,a.useState)(!1),[j,y]=(0,a.useState)(""),[N,w]=(0,a.useState)(""),[S,k]=(0,a.useState)(""),[P,C]=(0,a.useState)(""),[E,I]=(0,a.useState)(""),[M,T]=(0,a.useState)([]),[A,O]=(0,a.useState)(120),[L,B]=(0,a.useState)("C major");async function R(){try{p(!0),y("");let[e,t]=await Promise.all([l.ic.getSong(o),l.Me.list()]);h(e.song),x(t.singers||[]),k(e.song.title),C(e.song.description||""),I(e.song.genre||""),T(e.song.mood?JSON.parse(e.song.mood):[]),O(e.song.bpm),B(e.song.key),p(!1)}catch(e){console.error("[EditSong] Load error:",e),y(e instanceof Error?e.message:"Failed to load song"),p(!1)}}async function q(){if(!S.trim())return void y("Title is required");if(!E)return void y("Genre is required");if(A<40||A>200)return void y("BPM must be between 40 and 200");try{v(!0),y(""),w(""),w("Song updated successfully!"),setTimeout(()=>{s.push("/dashboard/music/".concat(o))},1500)}catch(e){console.error("[EditSong] Save error:",e),y(e instanceof Error?e.message:"Failed to update song"),v(!1)}}return(0,a.useEffect)(()=>{R()},[o]),f?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-violet-200 border-t-violet-600 rounded-full animate-spin"})}):j&&!c?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"max-w-md w-full rounded-2xl bg-white/70 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"Error"}),(0,r.jsx)("p",{className:"text-slate-600 mb-6",children:j}),(0,r.jsx)(i(),{href:"/dashboard/music",className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-semibold hover:from-violet-700 hover:to-fuchsia-700 transition-all",children:"Back to Music"})]})}):(0,r.jsx)("div",{className:"min-h-screen p-6 pb-24",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)(i(),{href:"/dashboard/music/".concat(o),className:"flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors mb-4",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,r.jsx)("span",{className:"font-medium",children:"Back to Song"})]}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:"Edit Song"}),c&&(0,r.jsx)("p",{className:"text-lg text-slate-600",children:"Update metadata and settings"})]}),N&&(0,r.jsx)("div",{className:"rounded-xl bg-green-50 border border-green-200 p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,r.jsx)("span",{className:"font-semibold",children:N})]})}),j&&(0,r.jsx)("div",{className:"rounded-xl bg-red-50 border border-red-200 p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{className:"font-semibold",children:j})]})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Basic Information"}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Song Title ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),placeholder:"e.g., Midnight Dreams",className:"w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Description"}),(0,r.jsx)("textarea",{value:P,onChange:e=>C(e.target.value),placeholder:"Describe your song...",rows:3,className:"w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-500 resize-none"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Genre ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{value:E,onChange:e=>I(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 focus:outline-none focus:ring-2 focus:ring-violet-500",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select genre..."}),d.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]})]}),(0,r.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Mood"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:u.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>{T(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:"px-4 py-2 rounded-xl font-semibold transition-all ".concat(M.includes(e)?"bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"),children:e},e))})]}),(0,r.jsxs)("div",{className:"rounded-2xl bg-white/70 backdrop-blur-xl p-8 border border-slate-200/50 shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Musical Settings"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["BPM (Beats Per Minute) ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"number",value:A,onChange:e=>O(parseInt(e.target.value)||0),min:40,max:200,className:"w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 focus:outline-none focus:ring-2 focus:ring-violet-500",required:!0}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Typical range: 60-180 BPM"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Musical Key ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("select",{value:L,onChange:e=>B(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-white border border-slate-200 text-slate-900 focus:outline-none focus:ring-2 focus:ring-violet-500",required:!0,children:m.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})]})]}),c&&g.length>0&&(0,r.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-violet-50 to-fuchsia-50 p-8 border border-slate-200/50 shadow-lg",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Singer"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-violet-600 to-fuchsia-600 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-lg font-bold text-slate-900",children:(null==(e=g.find(e=>e.id===c.singerId))?void 0:e.name)||"Unknown Singer"}),(0,r.jsx)("p",{className:"text-sm text-slate-600",children:"Singer cannot be changed after creation"})]})]})]}),(0,r.jsx)("div",{className:"rounded-2xl bg-gradient-to-br from-violet-50 to-fuchsia-50 p-8 border border-slate-200/50 shadow-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"Ready to save?"}),(0,r.jsx)("p",{className:"text-slate-600",children:"Your changes will be saved to the song metadata."})]}),(0,r.jsx)("button",{onClick:q,disabled:b||!S.trim()||!E||A<40||A>200,className:"px-8 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white font-bold text-lg hover:from-violet-700 hover:to-fuchsia-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):"Save Changes"})]})})]}),(0,r.jsx)("div",{className:"mt-6 rounded-xl bg-blue-50 border border-blue-200 p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,r.jsx)("strong",{children:"Note:"})," Changing the BPM or key won't affect existing versions, but will be used when generating new versions. To edit lyrics or generate new versions, use the respective options from the song detail page."]})})]})})]})})}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=2797)),_N_E=e.O()}]);