# AI Influencer - Wrangler Configuration
# This is a NEW project, completely separate from ai-singer-studio

name = "ai-influencer"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Worker configuration
workers_dev = true

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "ai-influencer-db"
database_id = "3ff456d9-e180-476b-8a4b-b93a09d1a24f"

# R2 Buckets for storing generated assets
[[r2_buckets]]
binding = "ASSETS_BUCKET"
bucket_name = "ai-influencer-assets"

[[r2_buckets]]
binding = "VIDEO_ASSETS"
bucket_name = "ai-influencer-video-assets"

# KV Namespaces
[[kv_namespaces]]
binding = "VIDEO_HISTORY"
id = "f884e80d59664e80b18a0aedb4a8bf7f"

[[kv_namespaces]]
binding = "SESSIONS"
id = "a25a8d67080a4c738a6126f17b58bcf5"

[[kv_namespaces]]
binding = "CACHE"
id = "05ab6102066f41dbbe5329b0d1d70ec0"

# Durable Objects
[[durable_objects.bindings]]
name = "QUOTA_MANAGER"
class_name = "QuotaManager"
script_name = "ai-influencer"

[[migrations]]
tag = "v1"
new_classes = ["QuotaManager"]

# Queues
[[queues.producers]]
binding = "JOB_QUEUE"
queue = "ai-influencer-jobs"

[[queues.consumers]]
queue = "ai-influencer-jobs"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
retry_delay = 5

# Environment Variables (use wrangler secret for sensitive values)
[vars]
ENVIRONMENT = "development"
CLERK_PUBLISHABLE_KEY = ""

# Secrets to set via CLI:
# wrangler secret put GEMINI_API_KEY
# wrangler secret put ELEVENLABS_API_KEY
# wrangler secret put OPENAI_API_KEY
# wrangler secret put VEO3_API_KEY
# wrangler secret put KIE_API_KEY
# wrangler secret put STRIPE_SECRET_KEY
# wrangler secret put STRIPE_WEBHOOK_SECRET
# wrangler secret put CLERK_SECRET_KEY

# Stream API
[ai]
binding = "AI"

# Analytics Engine
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Development environment
[env.development]
vars = { ENVIRONMENT = "development" }

# Staging environment
[env.staging]
vars = { ENVIRONMENT = "staging" }

# Production environment
[env.production]
compatibility_flags = ["nodejs_compat"]
vars = { ENVIRONMENT = "production", CLERK_PUBLISHABLE_KEY = "" }
workers_dev = true

# Production inherits all bindings from root config
[[env.production.d1_databases]]
binding = "DB"
database_name = "ai-influencer-db"
database_id = "3ff456d9-e180-476b-8a4b-b93a09d1a24f"

[[env.production.r2_buckets]]
binding = "ASSETS_BUCKET"
bucket_name = "ai-influencer-assets"

[[env.production.r2_buckets]]
binding = "VIDEO_ASSETS"
bucket_name = "ai-influencer-video-assets"

[[env.production.kv_namespaces]]
binding = "VIDEO_HISTORY"
id = "f884e80d59664e80b18a0aedb4a8bf7f"

[[env.production.kv_namespaces]]
binding = "SESSIONS"
id = "a25a8d67080a4c738a6126f17b58bcf5"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "05ab6102066f41dbbe5329b0d1d70ec0"

[[env.production.durable_objects.bindings]]
name = "QUOTA_MANAGER"
class_name = "QuotaManager"
script_name = "ai-influencer"

[[env.production.queues.producers]]
binding = "JOB_QUEUE"
queue = "ai-influencer-jobs"

[[env.production.queues.consumers]]
queue = "ai-influencer-jobs"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
retry_delay = 5

[env.production.ai]
binding = "AI"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

# Browser Rendering API for video merging
[env.production.browser]
binding = "BROWSER"

# Limits
[limits]
cpu_ms = 50000 # 50 seconds for long-running video operations
